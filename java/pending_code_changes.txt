Code changes:
 - Refactored metadata loading and closed all streams after loading.
